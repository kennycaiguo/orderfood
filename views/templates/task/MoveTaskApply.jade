doctype transitional
html(xmlns='http://www.w3.org/1999/xhtml')
  head
    title 原料首页
    link(rel='stylesheet', type='text/css', href='css/index.css')
    script(type='text/javascript', src='js/jquery-1.7.1.min.js')
    script.
      function del(id) {
          alert(id)
              $.ajax({
                  "url": "del/" + id,
                  "dataType": "JSON",
                  "type": "post",
                  "success": function (result) {
                      if (result > 0) {
                          alert("删除成功");
                          window.location.reload();
                      } else {
                          alert("删除失败");
                      }
                  }
              })
      }



      function getdel() {
          var checkbox_value = [];
          var obj = document.getElementsByName("indent")
          for (var k in obj) {
              if (obj[k].checked)
                  checkbox_value.push(obj[k].value)
          }
          $.ajax({
              "url": "getdel",
              "dataType": "json",
              "type": "post",
              "data": {
                  'arrays[]': checkbox_value
              },
              "success": function (result) {
                  if (result > 0) {
                      alert("删除成功")
                      window.location.href = 'stocklogin';
                  } else {
                      alert("删除失败");
                  }
              },

          });
      }

      function del() {
          $("input[name=all]").click(function () {
              if (this.checked) {
                  $("#tb :checkbox").prop("checked", true);
              } else {
                  $("#tb :checkbox").prop("checked", false);
              }
          });
      }




      function getInfo(){
         $(".mian_b_bg").html("");
         $("#lala").html("")
          var stockName = $("#stockName").val();
         alert(stockName)
          $.ajax({
              'url': 'getInfo/' + stockName,
              'dataType': 'JSON',
              'type': 'post',
              'success': function (result) {
                      $(".mian_b_bg").append("<tr><td></td><td>原料ID</td><td>原料名称</td><td>原料总量</td><td>原料单位</td><td onclose='3'>操作</td></tr>")
                  $(result).each(function () {
                      $(".mian_b_bg").append("<tr style='border-top:1px #DFE2E6 solid'><td><input type='checkbox' name='indent' value='"+this.stockid+"'></td><td>"+this.stockid+"</td><td><input class='stockName' value='"+this.stockname+"' style='border:white'></td><td>"+this.stockweight+"</td><td>"+this.stockunit+"</td><td class='mian_b_icon_01' (width='8%')><a href='javascript:void(0)' onclick='upd("+this.stockid+")'>编辑</a></td><td class='mian_b_icon_01' (width='8%')><a href='javascript:void(0)' onclick='del("+this.stockid+")'>删除</a></td></tr>")
                  });
                  aa();
              }
          })
      }
        function task() {
            window.location.href='task'
        }

      function upd(id) {
          window.location.href = 'upd?id='+id;
          $(this).parent();
      }


        $(function () {
            aa();
            del();
        });
        function aa() {
            $(".stockName").parent().dblclick(function () {
                $(this).find(" .stockName").css({background: "#eeeeee"}).removeAttr("disabled");
            });
            $(".stockName").attr("disabled", "disabled");
            $(".stockName").css({background: "transparent"}).blur(function () {
                $(this).attr("disabled", "disabled").css({background: "transparent"});
                var id = $(this).parent().prev().html();
                var name = $(this).val();
                alert(id)
                alert(name)
                UpdateStock(id, name);
            });
        }
      function UpdateStock(id,name) {
          $.ajax({
              "url": "UpdateStock",
              "data": {
                  stockid: id,
                  stockname: name
              },
              "dataType": "json",
              "type": "post",
              "success": function (result) {
                  if (result > 0) {
                      alert("修改成功");
                  } else {
                      alert("修改失败");
                  }
              }
          })
      }
    body.mian_bj
    .mian_top_01
      .mian_top_r
      .mian_top_l
      .mian_top_c
        ul
          li
            a(href='')
              p 原料管理
      .mian_b
        .mian_b1
          p.mian_b1_a1
            button(onclick='task()' style='width:80px;height:30px' )添加
          p.mian_b1_sousuo
            input(id='stockName', type='tex闪t')
          button(value='搜索' onclick='getInfo()' style='width:80px;padding-left:20px;margin:11px;height:30px;text-align:center')查询
          button(onclick='getdel()')批量删除
        table.mian_b_bg(width='100%', border='0', cellpadding='0', cellspacing='0')
          tbody#tb
            tr
              td.mian_b_bg_lm(width='10%')
                span
                input(type='checkbox' name='all')
                | 全选
              td.mian_b_bg_lm(width='10%')
                span
                | 原料ID
               // input(name='', type='checkbox', value='')
              td.mian_b_bg_lm(width='10%')
                span
                | 原料名称
              td.mian_b_bg_lm(width='10%')
                span
                | 原料总量
              td.mian_b_bg_lm(width='10%')
                span
                | 原料单位
              td.mian_b_bg_lm(colspan='3')
                span
                | 操作
              each item in users
                tr(id='trr')
                div(id='lala')
                    //(style='display:none')
                  td
                    input(type='checkbox' name='indent' value=item.stockid)
                  td=item.stockid
                  td
                    input.stockName(id='stockName',value=item.stockname style='border:none;')
                  //td#sname=item.stockname
                  td=item.stockweight
                  td=item.stockunit
                  td.mian_b_icon_01(width='8%')
                    a(href='javascript:void(0)' onclick='upd('+item.stockid+')') 编辑
                  td.mian_b_icon_01(width='8%')
                    a(href='#' onclick='del('+item.stockid+')')删除


